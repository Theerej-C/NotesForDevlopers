- Roles are the important feature of the ansible which minimise the cluttering of the code in a single file. This make easier to split the files into tasks and not into plays so we can use as many as we want in a single play using a single task file and mentioning it in the play.
- To get a roles structure we need to set up `roles` directory in the base of the main file for example the file which uses the roles.
- Then inside the roles we must make directories on the names of specific roles for example in main file if we mention `roles` name as `web_servers` then the folder name should also same. Then inside that folder again create a sub folder named as `tasks` and then inside that `tasks` create `main.yml` file which will hold the tasks.
![[Pasted image 20240503111516.png]]
- The above format is the exactly how we want to create the structure. Then in the `main.yml` just paste the tasks not the play like for `db_server:
```
- name: install mariadb server on CentOS
  tags: db,mariadb,centos
  yum:
    name: mariadb-server
    state: latest
  when: ansible_distribution == "CentOS"  
- name: Start mariadb service on centos
  tags: db,mariadb,centos
  service:
    name: mariadb
    state: started 
    enabled: yes
  when: ansible_distribution == "CentOS"
```
- Then inside the main playbook in the main directory add the tasks using the `roles` keyword and the name of the role like:
```
---
- hosts: all
  become: true
  tasks:
    - name: install updates (centos)
      tags: always
      yum:
        update_only: yes
        update_cache: yes
      when: ansible_distribution == "CentOS"
    - name: install updates (Ubuntu)
      tags: always
      apt:
        update_cache: yes
      when: ansible_distribution == "Ubuntu"
- hosts: all
  become: true
  roles:
    - base
- hosts: workstations
  become: true
  roles:
    - workstations
- hosts: web_servers
  become: true
  roles:
    - web_servers
- hosts: db_server
  become: true
  roles:
    - db_server
```
- This will run the roles separately in the tasks. The points to remember is the name of the directory should be same as roles and there should be at least `tasks` sub folder and addition to that there can be many sub folders for other features in ansible. Then if we use a file in the task of an role then the file should be in the `files` folder inside the `roles/ROLE_NAME` folder.